# 1. Резюме

[Appocalipsis](https://github.com/apocalipsis666/apocalipsis/blob/master/apocalipsis.sol) Аудит смарт катракта от [Rauan](https://github.com/RauanSatanbek)

Аудит проведен для [Bestroi.io](bestroi.io)


### Дисклеймер - 

Вся иформация содержащаяся здесь предназначена для того чтобы помочь показать уязвимые места и указать на то что работает.


# 2. Apocalipsis Ethereum Smart Contract:

## Описание контракта - 

* Нет функций останавить контракт.

* Минимальный платёж которую принимает контракт равен 0.05 ETH.

* Принимает платёж по указанию реферала.

* Поступившую сумму делит равномерно на 5 адресов.

* В качестве реферала один пользователь может стать 7 или 8 раз в зависимости то количество участников.

## Контракт

Файл смарт контракта -
- [appocalipsis.sol](https://github.com/apocalipsis666/apocalipsis/blob/master/apocalipsis.sol)

## Ключевые Переменные

* desimals = количество нулей 
* numMembers - количество участников
* minBid = миимальная количество wei, принимаемя контрактом, в нашем случай равен 0.05 ether или (50000000000000000 wei)
* _payments - хранит в себе ключ и значение, ключом вступает адрес РЕФЕРАЛА, а значение это цифра, сколько раз другие пользователи указали конкретного пользователя при отправление денег, значение увеличевается на одну еденицу каждым разом когда пользователи отправляют деньги в контракт 
* _downrefs - ключ и значение, ключом вступает адрес РЕФЕРАЛА, значение это массив из адресов тех кто указал адрес пользователя как своего РЕФЕРАЛА.
* _uprefs - ключ и значение, ключом вступает адрес РЕФЕРАЛА, значение 5 адресов реферала

## Опреторы проверки

1. У когтракта нет функции STOP (+)
2. Контракт не принимает сумму ниже 0.05 ether
3. Котракт приимает сумму больше или равно к 0.05 ether.
4. Если количество участников меньше 8000, то другие ползователи могут указывать как своего РЕФЕРАЛА одного пользователя только 8 раз.
5. Если количество учатников больше чем 7999, то другие пользователи могут указывать как своего РЕФЕРАЛА одного пользователя только 7 раз.
6. Отправитель не может указать себя в как РЕФЕРАЛА.
7. Адрес РЕФЕРАЛА не может быть пустым или равен пустому адресу (в системе Ethereum этот адрес равен 0x0).
8. Адрес РЕФЕРАЛА не может быть равен адресу самого контракта.
9. Пользователи могут отправлять деньги только один раз одним кашельком.

## Разделение сумму на 5 адресов

Превый цикл: Задача цикла разделить плучаемую сумму на 5 равных чатей и отправить их к пяти адресам

Цикл справляется со своей задачей, только если следовать по определенному сценарий. Это сценарий работает так, из начально у нас в переменной _uprefs указывается первый реферал и его 5 адресов, назавём его ПЕРВЫЙ.

Если новый пользоваетль отправить 30 ЭФИР и укажет  как своего реферала ПЕРВОГО, то как мы видим тут _uprefs[referal][i].transfer(amount);, каждому адресу реферала упадет по 5 ЭФИРОВ. 

Дальше идет второй цикл где заполняются первые четыре из пяти адресов нового пользователя, они копируется из последних чытырёх адресов ПЕРВОГО, а пятым адресом запишется адрес отправителя.

## Риски

Тут 

Первой потенциальной дырой программы состоит в том что если Я например укажу адрес реферала, у которого 5 адресов пустые, то отправляемый эфир отправится в нулевой адрес (0х0), и мы потеряем весь эфир. Плюс четыре нулевые адреса запишутся на счет отправителя. 

Вторая потенциальная дыра если, первоначльно указанный реферал ПЕРВЫЙ отправит эфир и укажет в качестве реферала пользователя у которого _uprefs адресов нет, то есть они пустые, то на счет ПЕРВОГО запишутся нулевые адреса.

## Что следует делать

— Тут ключевой момент перед отправление эфира нужно проверять адреса на корекность и путых адресов чтобы не терять деньги.  

— В математических операциях стоит использовать библиотеку безопастых математических операций SafeMath

## Заключение 

Я думаю нужно сконцентрировать внимание, месте где разделяются эфиры на пять адресов и на саму формулировку эти пяти адресов, так как там есть потенциальные дыры программы которые мугут привести к поторе эфиров.
